@model vallezweb.Source.Entidades.Quarto;

@{
    ViewData["Title"] = "Agendamento";

        var valorDiaria = Model.ValorDiaria;

}

<div class="titulo-agendamento">
    <h2>Insira os dados para efetuar o pedido de agendamento</h2>
    <div class="agendamento">

            <div class="esquerda">
                <h1>@Html.DisplayFor(model => model.Descricao)</h1>
                <img src="~/imgs/hotel-cama.png" alt="">
            </div>
        
            <div class="center">
                <div class="dados dados-cliente">
                    <p id="mensagem" class="mensagem">Você ainda não possui cadastro. <br/><br /> Por favor, preencha todos os campos para se cadastrar e realizar o agendamento</p>
                    <h3> Dados do Cliente</h3>
                    <label for="cpf">CPF: </label>
                    <input type="text" id="cpf" name="cpf" onblur="validarSeCpfEstaCadastrado()" />
                    <div class="hidden-fields">
                        <label for="nome">Nome Completo: </label>
                        <input type="text" id="nome" name="nome" />
                        <label for="rg">RG: </label>
                        <input type="text" id="rg" name="rg" />
                        <label for="contato">Celular: </label>
                        <input type="text" id="contato" name="contato" />
                        <label for="email">E-mail: </label>
                        <input type="email" id="email" name="email" />
                    </div>
                </div>


                <div class="dados dados-do-agendamento">
                    <h3> Dados do Agendamento</h3>
                    <p>Camas: @Html.DisplayFor(model => model.QtCamas)</p>
                    <p>Banheiros: @Html.DisplayFor(model => model.QtBanheiros)</p>
                    <p id="valor-diaria" data-algum-valor-aleatorio="birbirbirbribr" data-valor-diaria="@valorDiaria" >Valor Diaria: @valorDiaria.ToString("C", System.Globalization.CultureInfo.CurrentCulture) </p>
                    <label for="data-inicial">Data de Entrada: </label>
                    <input type="date" id="data-inicial" name="data-inicial" onchange="calculaValorAPagar()" />
                    <label for="data-fim">Data de Saida: </label>
                    <input type="date" id="data-fim" name="data-fim" onchange="calculaValorAPagar()" />

                    <p id="dias-totais" style="display:none"></p>
                    <p id="valor-final-estadia" style="display: none;"> </p>


                </div>

                <div class="botao">
                    <button>Enviar Pedido</button>
                </div>
            </div>

            <div class="direita">
                <img src="~/imgs/mapa.png" alt="">
            </div>
        
        </div>
</div>


@section Scripts {
    <script type="text/javascript">

        function calculaValorAPagar() {

            let dataInicial = new Date(document.getElementById("data-inicial").value + "T00:00:00");
            let dataFim = new Date(document.getElementById("data-fim").value + "T00:00:00");
            let dataHoje = new Date();

            if (dataInicial.getTime() <= dataHoje.getTime()) {
                alert("Data INICIAL não pode ser menor que o dia atual !!!");
                document.getElementById("data-inicial").value = "";
                return;
            }

            if (dataFim.getTime() <= dataHoje.getTime()) {
                alert("Data FIM não pode ser menor que o dia atual !!!");
                document.getElementById("data-fim").value = "";
                return;
            }

            if (dataFim.getTime() <= dataInicial.getTime()) {
                alert("Data FIM não pode ser menor que data INICIAL !!");
                document.getElementById("data-fim").value = "";
                return;
            }


            if (!isNaN(dataInicial) && !isNaN(dataFim) ) {

                let valorDiaria = document.getElementById("valor-diaria").dataset["valorDiaria"].replace(',', '.');

                //dataInicial = new Date(dataInicial);
                //dataFim = new Date(dataFim);

                let diferenca = dataFim.getTime() - dataInicial.getTime();
                let dias = diferenca / (1000 * 60 * 60 * 24);

                let valorTotalDiaria = parseFloat(valorDiaria) * dias;

                let elValorFinalDiaria = document.getElementById("valor-final-estadia");
                elValorFinalDiaria.style["display"] = "block";
                elValorFinalDiaria.innerHTML = "Valor Total: R$ " + valorTotalDiaria.toLocaleString("pt-BR");

                let elTotalDias = document.getElementById("dias-totais");
                elTotalDias.style["display"] = "block";
                elTotalDias.innerHTML = "Total de Dias: " + dias;

            }
            

        }

        async function validarSeCpfEstaCadastrado() {

            let cpf = document.getElementById("cpf").value;

            console.log(cpf);

            if (cpf) {

                document.querySelector('.agendamento .center .dados #mensagem').style["display"] = "block";
                document.querySelector('.agendamento .center .dados .hidden-fields').style["display"] = "block";

            }


            


        }


    </script>
}